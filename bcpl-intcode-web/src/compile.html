<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BCPL Compiler - Web Edition</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .compiler-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .editor-section, .output-section {
            display: flex;
            flex-direction: column;
        }
        textarea {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 10px;
            border: 1px solid #333;
            background: #1e1e1e;
            color: #d4d4d4;
            resize: vertical;
            min-height: 400px;
        }
        .compile-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .stage-info {
            background: #2d2d2d;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 12px;
        }
        .stage-info h4 {
            margin: 0 0 10px 0;
            color: #4ec9b0;
        }
        .progress {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        .progress.active {
            display: block;
        }
        .step {
            padding: 5px 0;
            color: #888;
        }
        .step.active {
            color: #4ec9b0;
            font-weight: bold;
        }
        .step.done {
            color: #6a9955;
        }
        .step.error {
            color: #f48771;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß BCPL Compiler</h1>
            <p class="subtitle">Compile BCPL source code to INTCODE in your browser</p>
        </header>

        <div class="main-content">
            <div class="stage-info">
                <h4>Compilation Pipeline</h4>
                <p><strong>Stage 1:</strong> syni (Syntax Analyzer) - Parses BCPL source ‚Üí OCODE</p>
                <p><strong>Stage 2:</strong> trni (Translator) - Transforms OCODE ‚Üí OCODE</p>
                <p><strong>Stage 3:</strong> cgi (Code Generator) - Generates OCODE ‚Üí INTCODE</p>
                <p style="margin-top: 10px; color: #6a9955;">All three stages run as INTCODE programs in the VM!</p>
            </div>

            <div class="compile-controls">
                <label for="fileInput" class="btn btn-primary">
                    üìÅ Load BCPL File
                    <input type="file" id="fileInput" accept=".b,.bcpl" style="display: none;" />
                </label>
                <button id="compileButton" class="btn btn-success">
                    ‚öôÔ∏è Compile to INTCODE
                </button>
                <button id="compileRunButton" class="btn btn-success">
                    ‚ñ∂Ô∏è Compile & Run
                </button>
                <button id="downloadIntcodeButton" class="btn btn-primary" disabled>
                    üíæ Download INTCODE
                </button>
                <button id="clearButton" class="btn btn-secondary">
                    üóëÔ∏è Clear
                </button>
            </div>

            <div class="progress" id="progress">
                <div class="step" id="step1">‚è≥ Loading compiler (syni + trni + cgi)...</div>
                <div class="step" id="step2">‚è≥ Stage 1: Running syntax analyzer (syni)...</div>
                <div class="step" id="step3">‚è≥ Stage 2: Running translator (trni)...</div>
                <div class="step" id="step4">‚è≥ Stage 3: Running code generator (cgi)...</div>
                <div class="step" id="step5">‚è≥ Compilation complete!</div>
            </div>

            <div class="compiler-panel">
                <div class="editor-section">
                    <h2>BCPL Source Code</h2>
                    <textarea id="sourceEditor" spellcheck="false" placeholder="// Enter BCPL source code here
GET &quot;LIBHDR&quot;

LET START() BE $(
  WRITES(&quot;Hello, BCPL!*N&quot;)
$)">GET "LIBHDR"

LET START() BE $(
  WRITES("Hello from BCPL Compiler!*N")
  FOR I = 1 TO 10 DO $(
    WRITEF("Count: %I3*N", I)
  $)
$)</textarea>
                </div>

                <div class="output-section">
                    <h2>Output</h2>
                    <textarea id="outputArea" readonly placeholder="Compilation output and program results will appear here..."></textarea>
                </div>
            </div>
        </div>

        <footer>
            <div class="info-section">
                <h3>How It Works</h3>
                <p>
                    This web-based BCPL compiler uses the original BCPL compiler components (syni, trni, cgi)
                    compiled to INTCODE. When you click "Compile", the JavaScript VM loads and executes these
                    three programs in sequence, just like on the original C64!
                </p>
                <p style="margin-top: 10px;">
                    The entire compilation happens inside the INTCODE virtual machine, demonstrating the 
                    self-hosting capability of BCPL - a compiler written in BCPL, compiled to INTCODE,
                    running in a JavaScript VM in your browser! ü§Ø
                </p>
            </div>
        </footer>
    </div>

    <script src="js/intcodeVM.js?v=FINAL9999"></script>
    <script src="js/intcodeAssembler2.js?v=FINAL9999"></script>
    <script src="js/intcodeLoader.js?v=FINAL9999"></script>
    <script src="js/compiler.js?v=FINAL9999"></script>
</body>
</html>
